cmake_minimum_required(VERSION 3.16)
project(programmers-c-coding-test-study C CXX)  # C++ë„ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)

set(CMAKE_C_STANDARD 99)
set(CMAKE_CXX_STANDARD 17)  # Google Testìš©

if (WIN32)
    # Windows ì‹œìŠ¤í…œ ë¡œì¼€ì¼ í™•ì¸ì„ ìœ„í•œ í•¨ìˆ˜
    function(get_system_encoding result)
        execute_process(
                COMMAND powershell.exe -NoProfile -Command "[System.Text.Encoding]::Default.WindowsCodePage"
                OUTPUT_VARIABLE codepage
                OUTPUT_STRIP_TRAILING_WHITESPACE
                ERROR_QUIET
        )
        set(${result} ${codepage} PARENT_SCOPE)
    endfunction()

    # ì‹œìŠ¤í…œ ì¸ì½”ë”© í™•ì¸
    get_system_encoding(SYSTEM_CODEPAGE)

    # CP949(MS949), CP65001(UTF-8)ì¸ ê²½ìš°ì— EUC-KR ë˜ëŠ” UTF-8 ì‹¤í–‰ ë¬¸ìì…‹ ì˜µì…˜ ì¶”ê°€
    if (SYSTEM_CODEPAGE EQUAL 949)
        if (MSVC)
            # Visual Studio cl.exeë¥¼ ì‚¬ìš©í•  ë•Œ, ìœˆë„ìš° í„°ë¯¸ë„ í™˜ê²½ì€ CP949 ì¸ë°,
            # ì†ŒìŠ¤íŒŒì¼ì„ UTF-8ë¡œ ì €ì¥í•´ì„œ ê´€ë¦¬í•  ê²½ìš°, ì»´íŒŒì¼ëŸ¬ ì•„ë˜ ì˜µì…˜ì„ ì „ë‹¬í•œë‹¤.
            add_compile_options(/source-charset:utf-8 /execution-charset:euc-kr)
            message(STATUS "Added MSVC charset options for CP949 system encoding")
        elseif (MINGW)
            add_compile_options(-fexec-charset=CP949 -g -W -Wall)
            message(STATUS "Added MinGW charset options for CP949 system encoding")
        endif ()
    elseif (SYSTEM_CODEPAGE EQUAL 65001)
        if (MSVC)
            add_compile_options(/source-charset:utf-8 /execution-charset:utf-8)
            message(STATUS "Added MSVC charset options for UTF-8 system encoding")
        elseif (MINGW)
            add_compile_options(-fexec-charset=UTF-8 -g -W -Wall)
            message(STATUS "Added MinGW charset options for UTF-8 system encoding")
        endif ()
    else ()
        message(STATUS "Using system default encoding (Codepage: ${SYSTEM_CODEPAGE})")
    endif ()
endif ()

# í…ŒìŠ¤íŠ¸ ë¹Œë“œ ì˜µì…˜
option(BUILD_TESTING "Build tests with Google Test" ON)

# Google Test ì„¤ì • (í…ŒìŠ¤íŠ¸ê°€ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ)
if (BUILD_TESTING)
    include(FetchContent)
    FetchContent_Declare(
            googletest
            GIT_REPOSITORY https://github.com/google/googletest.git
            GIT_TAG v1.17.0
    )

    # Google Testì˜ ì„¤ì •ì´ ìš°ë¦¬ í”„ë¡œì íŠ¸ì— ì˜í–¥ì£¼ì§€ ì•Šë„ë¡
    set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

    # ğŸ’¡ gmockì„ ê°™ì´ ë¹Œë“œí•œë‹¤. gmockì—ì„œ ì œê³µë˜ëŠ” matcherê°€ ë‹¤ì–‘í•¨.
    set(BUILD_GMOCK ON CACHE BOOL "" FORCE)
    set(INSTALL_GTEST OFF CACHE BOOL "" FORCE)

    FetchContent_MakeAvailable(googletest)
    enable_testing()

    message(STATUS "Google Test enabled for testing")
endif ()


# ê³µí†µ í•¨ìˆ˜ ëª¨ìŒ ë¼ì´ë¸ŒëŸ¬ë¦¬
set(COMMON_LIB_PROJECT CommonUtils)
set(COMMON_LIB_NAME ${COMMON_LIB_PROJECT})

add_subdirectory(CommonUtils)

# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ìœ„í•œ ì»¤ìŠ¤í…€ íƒ€ê²Ÿ (í…ŒìŠ¤íŠ¸ê°€ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ)
if (BUILD_TESTING)
    add_custom_target(run_all_tests
            COMMAND ${CMAKE_CTEST_COMMAND} --verbose --output-on-failure
            COMMENT "Running all tests"
            USES_TERMINAL
    )
endif ()

# ê° ë ˆë²¨ë³„ í•˜ìœ„ ë””ë ‰í† ë¦¬ ì¶”ê°€
add_subdirectory(lv00)
